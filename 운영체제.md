# 운영체제

---

## 운영체제 개념 이해

### 운영체제란?

- OS (Operating System)
- 주요 운영체제 : 윈도우, UNIX 계열 OS (리눅스), Mac OS
- OS는 더 정확히는 커널(kernel)을 의미함

### 안드로이드는 OS인가?

- 아니다. 안드로이드에는 리눅스라는 OS가 들어가 있다.
- 커널과 프로그램 사이에 많은 시스템 프로그램과 함수(라이브러리)들이 존재한다.

---

## 커널과 쉘 이해

### 쉘

- 사용자에게 운영체제 기능과 서비스를 조작하는 사용법, 즉 인터페이스를 제공하는 프로그램
- 쉘은 터미널 환경(CLI)과 GUI 환경 두 종류로 분류
- 개발자는 터미널 환경에 익숙해질 필요가 있다 (특히 리눅스)

### 시스템 콜

- 시스템 콜 또는 시스템 호출 인터페이스
- 운영체제가 운영체제 각 기능을 사용할 수 있도록 시스템 콜이라는 함수를 제공

### API

- 모호한 용어이지만 간단히 함수 또는 라이브러리라고 이해하면 됨
- 프로그래밍 언어별 해당 운영체제에 맞는 API 구현
- API 내부에는 필요시 해당 운영체제의 시스템콜을 호출하는 형태로 만들어짐

### 운영체제를 만든다면?

1. 운영체제를 개발한다. (kernel)
2. 시스템콜을 개발
3. 시스템콜 기반, 프로그래밍 언어별 라이브러리 개발(API)
4. 지원되는 프로그래밍 언어로 Shell 프로그램 개발
5. 지원되는 프로그래밍 언어로 응용 프로그램 개발

---

## 커널 모드와 사용자 모드 이해

- 우리가 어떤 명령을 실행할 때, 직접 운영체제에 접근할 수 없고 커널을 통해서만 할 수 있다.
- 주민등록등본을 정부 시스템에 직접 접근해서 떼는게 아니라, 동사무소를 통해서 떼는 것과 같다.
- 함부로 응용 프로그램이 전체 컴퓨터 시스템을 헤치지 못하게 하기 위함

## CPU Protection Ring

- 사용자 모드 : 응용 프래그램이 사용
- 커널 모드 : OS가 사용
- 권한 레벨에 따라 접근 가능

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f8feaee9-791c-4162-b25d-9dfdaf868d31/Untitled.png)

### 시스템콜은 커널 모드로 실행

- 커널 모드에서만 실행 가능한 기능들이 있음
- 커널 모드로 실행하려면, 반드시 시스템 콜을 사용해야 함 (거쳐야 함)
- 시스템 콜은 운영체제 제공

### 정리

- 운영체제는 시스템 콜 제공
- 프로그래밍 언어별 운영체제 지원을 위해, 운영체제 별 API 제공
- 응용 프로그램 개발시 운영체제 기능이 필요한 경우, 해당 API를 사용해서 프로그램 작성
- 응용 프로그램 실행시, 해당 API를 호출하면, 시스템 콜 호출, **커널 모드로 변경 후,** OS 내부에서 해당 명령이 실행되고, 응용 프로그램에 결과 리턴

---

## 운영체제 역할 정리

### 1. 시스템 자원 관리자

- 시스템 자원 = 컴퓨터 하드웨어
- CPU, Memory, 입출력장치, 저장매체
- 이 모든 것을 운영체제가 관리한다.

### 2. 사용자와 컴퓨터 간의 커뮤니케이션 지원

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/51c63e85-28ae-4c67-98a7-49c598aab0e1/Untitled.png)

### 3. 응용 프로그램 제어

- 응용 프로그램의 권한을 운영체제가 관리함

## 정리

### 응용 프로그램이란?

- 프로그램 = 소프트웨어
- 소프트웨어 = 운영체제, 응용 프로그램
- 응용 프로그램 = Application

### 운영체제와 응용 프로그램간의 관계

- 운영체제는 응용 프로그램을 관리
    - 실행, 권한 관리
    - 응용 프로그램을 사용하는 사용자도 관리 (로그인)
- 응용 프로그램은 누구나 만들 수 있다.
- 응용 프로그램이 무슨 짓을 할지 모르기 때문에, 운영체제가 관리해야 한다.

---

## 프로세스 개념 이해

### 프로세스란?

- 실행 중인 프로그램은 프로세스라고 함
    - 프로세스: 메모리에 올려져서, 실행 중인 프로그램
    - 코드 이미지(바이너리): 실행 파일
- 응용 프로그램 ≠ 프로세스
    - 응용 프로그램은 여러 프로세스로 구성 가능

---

## 운영체제 스케쥴링 기본

### 배치 처리 시스템

- 맨 처음 채택했던 시스템
- 실행할 프로세스를 등록하고 순차적으로 프로세스를 실행
- 이 방식은 동시에 여러개의 프로세스를 실행할 수 없는 한계가 있음

### 시분할 시스템

- **다중 사용자 지원**을 위해 컴퓨터 응답 시간을 최소화하는 시스템
- 응용 프로그램이 CPU를 점유하는 **시간을 잘게 쪼개어 실행**될 수 있도록 함

### 멀티 태스킹

- 단일 CPU에서, **여러 응용 프로그램이 동시에 실행**되는 것처럼 보이도록 하는 시스템
- 10 - 20 ms 단위로도 실행 응용 프로그램이 바뀜
- 알고리즘의 구현은 시분할 시스템과 같다. 목적이 다르다.

### 멀티 프로그램

- 최대한 CPU를 많이 활용하도록 하는 시스템
- 멀티 프로그래밍 : CPU 활용도를 극대화 하는 스케쥴링 알고리즘
- CPU가 다른 동작을 하기 위해 기다리는 시간을 모두 활용

### 멀티 태스킹과 멀티 프로세싱

- 멀티 태스킹 : 단일 CPU
- 멀티 프로세싱 : 여러 CPU에 하나의 프로그램을 병렬로 실행해서 실행속도를 극대화시키는 시스템

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/634b077a-f40b-4193-8214-50cc41b85798/Untitled.png)

---

## 스케쥴링 알고리즘 구현 이해

### 스케쥴러와 프로세스

- 스케쥴러 : 프로세스 실행을 관리
    - 목표 : 시분할 시스템, 멀티 프로그래밍

### FIFO 스케쥴러

- 가장 간단한 스케쥴러 (배치 처리 시스템)
- Queue 자료구조를 사용

### 최단 작업 우선 (SJF) 스케쥴러

- 가장 프로세스 실행시간이 짧은 프로세스부터 먼저 실행을 시키는 알고리즘
    - 좋은 개발자가 개발한다면
    - 우선순위 큐와 힙 자료구조 사용을 고려할 것 (시간복잡도가 O(nlogn)이기 때문)
    - 스케쥴러는 운영체제의 핵심기능으로 빈번하게 호출됨
    - 때문에 스케쥴러 알고리즘의 성능은 운영체제 성능에 큰 영향을 미침

### 가끔 이야기가 나오는 용어

- RealTime OS (RTOS) : 응용 프로그램 실시간 성능 보장을 목표로 함
    - 정확하게 프로그램 시작, 완료 시간을 보장
- General Purpose OS (GPOS)
    - 프로세스 실행시간에 민감하지 않고, 일반적으로 사용되는 OS (window, linux)

### 우선순위 기반 스케쥴러

- 정적 우선순위
    - 프로세스마다 우선순위를 미리 지정
- 동적 우선순위
    - 스케쥴러가 상황에 따라 우선순위를 동적으로 변경

### Round Robin 스케쥴러

- 큐에 실행할 프로세스를 저장하고 순차적으로 실행
- 프로세스가 일정 시간 이상 걸리면 다시 큐로 보내고 다음 프로세스를 실행
- 시분할 시스템

### 프로세스 상태 기반 스케쥴러

- 프로세스에 상태 정보를 넣어서 상태를 기반으로 스케쥴링
- ready, running, block states 상태를 오고가며 프로세스가 실행된다.
- Round Robin 방식으로 구현
- 멀티 프로그래밍

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/7769e0b7-6cda-4b69-8952-f64b0ba3a316/Untitled.png)

---

## 프로세스 구조 이해

### 프로세스 구조

- 프로세스는 어떻게 구성되어 있을까?
    - text(CODE) : 코드
    - data : 변수/ 초기화된 데이터
    - stack : 임시 데이터(함수 호출, 로컬 변수 등)
    - heap : 코드에서 동적으로 만들어지는 데이터

## 힙과 컨텍스트 스위칭 이해

### Heap이란?

- 우선순위의 개념을 큐에 도입한 자료구조
    - 원래 큐는 가장 먼저 들어온 데이터를 내보낸다.
    - heap은 가장 우선순위가 높은 데이터를 내보낸다.

### 컨텍스트 스위칭

- 문맥 교환
    - CPU에 실행할 프로세스를 교체하는 기술
- PC, SP만 바꿔주면, 프로세스 저장상태를 기반으로 실행 가능

### Process Control Block (PCB)

- PCB
    - 프로세스가 실행중인 상태를 캡쳐/구조화해서 저장
- 프로세스의 상태를 저장하여 컨텍스트 스위칭을 가능하게 함

## 멀티 프로세스와 IPC 이해

### 프로세스간 커뮤니케이션

- 프로세스는 다른 프로세스의 공간을 접근할 수 없다.
- 프로세스는 독립된 별도의 공간을 생성해서 실행된다.
- 여러 프로세스를 동시에 실행할 수 있다면, 성능이 매우 높아짐
- 이 때 프로세스간 상태 확인 및 데이터 송수신이 필요하다.

### IPC (InterProcess Communication)

- 프로세스들 사이에 서로 데이터를 주고받는 행위.
- 메세지 큐, 소켓, 신호 등의 방법을 주로 쓴다.
- 위 세 가지 방법은 모두 커널을 이용한 방법이다.

> 프로세스는 커널 공간을 공유할 수 있다.
> 

> 커널 공간에 특별한 메모리 공간을 만들고, 이를 사용해서 프로세스간 데이터를 공유할 수 있다.
> 

---

# 스레드 (Thread)

- Light Weight Process 라고도 함
- 프로세스
    - 프로세스 간에는 각 프로세스의 데이터 접근이 불가
- 스레드
    - 하나의 프로세스에 여러개 스레드 생성 가능
    - 스레드들은 동시에 실행 가능
    - 프로세스 안에 있으므로, 프로세스의 데이터를 모두 접근 가능
